<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="88,1" id="srcline1">  1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T22U3">x0</span>,<span class="var type1" id="S3T22U4">y0</span>] = intersections_coder(<span class="var type1" id="S4T12U7">x1</span>,<span class="var type1" id="S5T12U8">y1</span>,<span class="var type1" id="S6T22U9">x2</span>,<span class="var type1" id="S7T22U10">y2</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="88,2" id="srcline2">  2</a></span><span class="line"><span class="comment">%INTERSECTIONS Intersections of curves.</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,3" id="srcline3">  3</a></span><span class="line"><span class="comment">%   Computes the (x,y) locations where two curves intersect.  The curves</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,4" id="srcline4">  4</a></span><span class="line"><span class="comment">%   can be broken with NaNs or have vertical segments.</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,5" id="srcline5">  5</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,6" id="srcline6">  6</a></span><span class="line"><span class="comment">% Example:</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,7" id="srcline7">  7</a></span><span class="line"><span class="comment">%   [X0,Y0] = intersections(X1,Y1,X2,Y2,ROBUST);</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,8" id="srcline8">  8</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,9" id="srcline9">  9</a></span><span class="line"><span class="comment">% where X1 and Y1 are equal-length vectors of at least two points and</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,10" id="srcline10"> 10</a></span><span class="line"><span class="comment">% represent curve 1.  Similarly, X2 and Y2 represent curve 2.</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,11" id="srcline11"> 11</a></span><span class="line"><span class="comment">% X0 and Y0 are column vectors containing the points at which the two</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,12" id="srcline12"> 12</a></span><span class="line"><span class="comment">% curves intersect.</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,13" id="srcline13"> 13</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,14" id="srcline14"> 14</a></span><span class="line"><span class="comment">% ROBUST (optional) set to 1 or true means to use a slight variation of the</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,15" id="srcline15"> 15</a></span><span class="line"><span class="comment">% algorithm that might return duplicates of some intersection points, and</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,16" id="srcline16"> 16</a></span><span class="line"><span class="comment">% then remove those duplicates.  The default is true, but since the</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,17" id="srcline17"> 17</a></span><span class="line"><span class="comment">% algorithm is slightly slower you can set it to false if you know that</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,18" id="srcline18"> 18</a></span><span class="line"><span class="comment">% your curves don't intersect at any segment boundaries.  Also, the robust</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,19" id="srcline19"> 19</a></span><span class="line"><span class="comment">% version properly handles parallel and overlapping segments.</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,20" id="srcline20"> 20</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,21" id="srcline21"> 21</a></span><span class="line"><span class="comment">% The algorithm can return two additional vectors that indicate which</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,22" id="srcline22"> 22</a></span><span class="line"><span class="comment">% segment pairs contain intersections and where they are:</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,23" id="srcline23"> 23</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,24" id="srcline24"> 24</a></span><span class="line"><span class="comment">%   [X0,Y0,I,J] = intersections(X1,Y1,X2,Y2,ROBUST);</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,25" id="srcline25"> 25</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,26" id="srcline26"> 26</a></span><span class="line"><span class="comment">% For each element of the vector I, I(k) = (segment number of (X1,Y1)) +</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,27" id="srcline27"> 27</a></span><span class="line"><span class="comment">% (how far along this segment the intersection is).  For example, if I(k) =</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,28" id="srcline28"> 28</a></span><span class="line"><span class="comment">% 45.25 then the intersection lies a quarter of the way between the line</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,29" id="srcline29"> 29</a></span><span class="line"><span class="comment">% segment connecting (X1(45),Y1(45)) and (X1(46),Y1(46)).  Similarly for</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,30" id="srcline30"> 30</a></span><span class="line"><span class="comment">% the vector J and the segments in (X2,Y2).</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,31" id="srcline31"> 31</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,32" id="srcline32"> 32</a></span><span class="line"><span class="comment">% You can also get intersections of a curve with itself.  Simply pass in</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,33" id="srcline33"> 33</a></span><span class="line"><span class="comment">% only one curve, i.e.,</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,34" id="srcline34"> 34</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,35" id="srcline35"> 35</a></span><span class="line"><span class="comment">%   [X0,Y0] = intersections(X1,Y1,ROBUST);</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,36" id="srcline36"> 36</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,37" id="srcline37"> 37</a></span><span class="line"><span class="comment">% where, as before, ROBUST is optional.</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,38" id="srcline38"> 38</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="88,39" id="srcline39"> 39</a></span><span class="line"><span class="comment">% Version: 1.12, 27 January 2010</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,40" id="srcline40"> 40</a></span><span class="line"><span class="comment">% Author:  Douglas M. Schwarz</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,41" id="srcline41"> 41</a></span><span class="line"><span class="comment">% Email:   dmschwarz=ieee*org, dmschwarz=urgrad*rochester*edu</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,42" id="srcline42"> 42</a></span><span class="line"><span class="comment">% Real_email = regexprep(Email,{'=','*'},{'@','.'})</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,43" id="srcline43"> 43</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="88,44" id="srcline44"> 44</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="88,45" id="srcline45"> 45</a></span><span class="line"><span class="comment">% Theory of operation:</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,46" id="srcline46"> 46</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,47" id="srcline47"> 47</a></span><span class="line"><span class="comment">% Given two line segments, L1 and L2,</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,48" id="srcline48"> 48</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,49" id="srcline49"> 49</a></span><span class="line"><span class="comment">%   L1 endpoints:  (x1(1),y1(1)) and (x1(2),y1(2))</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,50" id="srcline50"> 50</a></span><span class="line"><span class="comment">%   L2 endpoints:  (x2(1),y2(1)) and (x2(2),y2(2))</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,51" id="srcline51"> 51</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,52" id="srcline52"> 52</a></span><span class="line"><span class="comment">% we can write four equations with four unknowns and then solve them.  The</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,53" id="srcline53"> 53</a></span><span class="line"><span class="comment">% four unknowns are t1, t2, x0 and y0, where (x0,y0) is the intersection of</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,54" id="srcline54"> 54</a></span><span class="line"><span class="comment">% L1 and L2, t1 is the distance from the starting point of L1 to the</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,55" id="srcline55"> 55</a></span><span class="line"><span class="comment">% intersection relative to the length of L1 and t2 is the distance from the</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,56" id="srcline56"> 56</a></span><span class="line"><span class="comment">% starting point of L2 to the intersection relative to the length of L2.</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,57" id="srcline57"> 57</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,58" id="srcline58"> 58</a></span><span class="line"><span class="comment">% So, the four equations are</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,59" id="srcline59"> 59</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,60" id="srcline60"> 60</a></span><span class="line"><span class="comment">%    (x1(2) - x1(1))*t1 = x0 - x1(1)</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,61" id="srcline61"> 61</a></span><span class="line"><span class="comment">%    (x2(2) - x2(1))*t2 = x0 - x2(1)</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,62" id="srcline62"> 62</a></span><span class="line"><span class="comment">%    (y1(2) - y1(1))*t1 = y0 - y1(1)</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,63" id="srcline63"> 63</a></span><span class="line"><span class="comment">%    (y2(2) - y2(1))*t2 = y0 - y2(1)</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,64" id="srcline64"> 64</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,65" id="srcline65"> 65</a></span><span class="line"><span class="comment">% Rearranging and writing in matrix form,</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,66" id="srcline66"> 66</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,67" id="srcline67"> 67</a></span><span class="line"><span class="comment">%  [x1(2)-x1(1)       0       -1   0;      [t1;      [-x1(1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,68" id="srcline68"> 68</a></span><span class="line"><span class="comment">%        0       x2(2)-x2(1)  -1   0;   *   t2;   =   -x2(1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,69" id="srcline69"> 69</a></span><span class="line"><span class="comment">%   y1(2)-y1(1)       0        0  -1;       x0;       -y1(1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,70" id="srcline70"> 70</a></span><span class="line"><span class="comment">%        0       y2(2)-y2(1)   0  -1]       y0]       -y2(1)]</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,71" id="srcline71"> 71</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,72" id="srcline72"> 72</a></span><span class="line"><span class="comment">% Let's call that A*T = B.  We can solve for T with T = A\B.</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,73" id="srcline73"> 73</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,74" id="srcline74"> 74</a></span><span class="line"><span class="comment">% Once we have our solution we just have to look at t1 and t2 to determine</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,75" id="srcline75"> 75</a></span><span class="line"><span class="comment">% whether L1 and L2 intersect.  If 0 &lt;= t1 &lt; 1 and 0 &lt;= t2 &lt; 1 then the two</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,76" id="srcline76"> 76</a></span><span class="line"><span class="comment">% line segments cross and we can include (x0,y0) in the output.</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,77" id="srcline77"> 77</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,78" id="srcline78"> 78</a></span><span class="line"><span class="comment">% In principle, we have to perform this computation on every pair of line</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,79" id="srcline79"> 79</a></span><span class="line"><span class="comment">% segments in the input data.  This can be quite a large number of pairs so</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,80" id="srcline80"> 80</a></span><span class="line"><span class="comment">% we will reduce it by doing a simple preliminary check to eliminate line</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,81" id="srcline81"> 81</a></span><span class="line"><span class="comment">% segment pairs that could not possibly cross.  The check is to look at the</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,82" id="srcline82"> 82</a></span><span class="line"><span class="comment">% smallest enclosing rectangles (with sides parallel to the axes) for each</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,83" id="srcline83"> 83</a></span><span class="line"><span class="comment">% line segment pair and see if they overlap.  If they do then we have to</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,84" id="srcline84"> 84</a></span><span class="line"><span class="comment">% compute t1 and t2 (via the A\B computation) to see if the line segments</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,85" id="srcline85"> 85</a></span><span class="line"><span class="comment">% cross, but if they don't then the line segments cannot cross.  In a</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,86" id="srcline86"> 86</a></span><span class="line"><span class="comment">% typical application, this technique will eliminate most of the potential</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,87" id="srcline87"> 87</a></span><span class="line"><span class="comment">% line segment pairs.</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,88" id="srcline88"> 88</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="88,89" id="srcline89"> 89</a></span><span class="line"><span class="comment">% self_intersect = false;</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,90" id="srcline90"> 90</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="88,91" id="srcline91"> 91</a></span><span class="line"><span class="comment">% x1 and y1 must be vectors with same number of points (at least 2).</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,92" id="srcline92"> 92</a></span><span class="line"><span class="keyword">if</span> sum(size(<span class="var type1" id="S4T12U21">x1</span>) &gt; 1) ~= 1 || sum(size(<span class="var type1" id="S5T12U30">y1</span>) &gt; 1) ~= 1 || <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,93" id="srcline93"> 93</a></span><span class="line">        length(<span class="var type1" id="S4T12U36">x1</span>) ~= length(<span class="var type1" id="S5T12U39">y1</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="88,94" id="srcline94"> 94</a></span><span class="line">    error(<span class="string">'X1 and Y1 must be equal-length vectors of at least 2 points.'</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="88,95" id="srcline95"> 95</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,96" id="srcline96"> 96</a></span><span class="line"><span class="comment">% x2 and y2 must be vectors with same number of points (at least 2).</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,97" id="srcline97"> 97</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T2:U11"><span class="mxinfo" id="T1:U12">sum(<span class="mxinfo" id="T17:U13"><span class="mxinfo" id="T10:U14">size(<span class="var type1" id="S6T22U54">x2</span>)</span> &gt; <span class="mxinfo" id="T1:U16">1</span></span>)</span> ~= <span class="mxinfo" id="T1:U17">1</span></span> || <span class="mxinfo" id="T2:U18"><span class="mxinfo" id="T1:U19">sum(<span class="mxinfo" id="T17:U20"><span class="mxinfo" id="T10:U21">size(<span class="var type1" id="S7T22U63">y2</span>)</span> &gt; <span class="mxinfo" id="T1:U23">1</span></span>)</span> ~= <span class="mxinfo" id="T1:U24">1</span></span> || <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,98" id="srcline98"> 98</a></span><span class="line">        <span class="mxinfo" id="T2:U25"><span class="mxinfo" id="T1:U26">length(<span class="var type1" id="S6T22U69">x2</span>)</span> ~= <span class="mxinfo" id="T1:U28">length(<span class="var type1" id="S7T22U72">y2</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="88,99" id="srcline99"> 99</a></span><span class="line">    error(<span class="string">'X2 and Y2 must be equal-length vectors of at least 2 points.'</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="88,100" id="srcline100">100</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,101" id="srcline101">101</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="88,102" id="srcline102">102</a></span><span class="line"><span class="comment">% Force all inputs to be column vectors.</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,103" id="srcline103">103</a></span><span class="line"><span class="mxinfo" id="T12:U30"><span class="var type1" id="S4T12U79">x1</span> = <span class="mxinfo" id="T12:U32"><span class="var type1" id="S4T12U81">x1</span>(:)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="88,104" id="srcline104">104</a></span><span class="line"><span class="mxinfo" id="T12:U34"><span class="var type1" id="S5T12U85">y1</span> = <span class="mxinfo" id="T12:U36"><span class="var type1" id="S5T12U87">y1</span>(:)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="88,105" id="srcline105">105</a></span><span class="line"><span class="mxinfo" id="T22:U38"><span class="var type1" id="S6T22U91">x2</span> = <span class="mxinfo" id="T22:U40"><span class="var type1" id="S6T22U93">x2</span>(:)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="88,106" id="srcline106">106</a></span><span class="line"><span class="mxinfo" id="T22:U42"><span class="var type1" id="S7T22U97">y2</span> = <span class="mxinfo" id="T22:U44"><span class="var type1" id="S7T22U99">y2</span>(:)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="88,107" id="srcline107">107</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="88,108" id="srcline108">108</a></span><span class="line"><span class="comment">% Compute number of line segments in each curve and some differences we'll</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,109" id="srcline109">109</a></span><span class="line"><span class="comment">% need later.</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,110" id="srcline110">110</a></span><span class="line"><span class="mxinfo" id="T1:U46"><span class="var type1" id="S12T1U103">n1</span> = <span class="mxinfo" id="T1:U48">length(<span class="var type1" id="S4T12U107">x1</span>) - 1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="88,111" id="srcline111">111</a></span><span class="line"><span class="mxinfo" id="T1:U50"><span class="var type1" id="S13T1U111">n2</span> = <span class="mxinfo" id="T1:U52"><span class="mxinfo" id="T1:U53">length(<span class="var type1" id="S6T22U115">x2</span>)</span> - <span class="mxinfo" id="T1:U55">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="88,112" id="srcline112">112</a></span><span class="line"><span class="mxinfo" id="T23:U56"><span class="var type1" id="S14T23U119">xy1</span> = <span class="mxinfo" id="T23:U58">[<span class="var type1" id="S4T12U122">x1</span> <span class="var type1" id="S5T12U123">y1</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="88,113" id="srcline113">113</a></span><span class="line"><span class="mxinfo" id="T15:U61"><span class="var type1" id="S15T15U126">xy2</span> = <span class="mxinfo" id="T15:U63">[<span class="var type1" id="S6T22U129">x2</span> <span class="var type1" id="S7T22U130">y2</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="88,114" id="srcline114">114</a></span><span class="line"><span class="mxinfo" id="T10:U66"><span class="var type1" id="S16T10U133">dxy1</span> = <span class="mxinfo" id="T10:U68">diff(<span class="var type1" id="S14T23U136">xy1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="88,115" id="srcline115">115</a></span><span class="line"><span class="mxinfo" id="T27:U70"><span class="var type1" id="S18T27U139">dxy2</span> = <span class="mxinfo" id="T27:U72">diff(<span class="var type1" id="S15T15U142">xy2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="88,116" id="srcline116">116</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="88,117" id="srcline117">117</a></span><span class="line"><span class="comment">% Determine the combinations of i and j where the rectangle enclosing the</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,118" id="srcline118">118</a></span><span class="line"><span class="comment">% i'th line segment of curve 1 overlaps with the rectangle enclosing the</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,119" id="srcline119">119</a></span><span class="line"><span class="comment">% j'th line segment of curve 2.</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,120" id="srcline120">120</a></span><span class="line"><span class="mxinfo" id="T22:U74">[<span class="var type1" id="S19T22U146">i</span>,<span class="var type1" id="S20T22U147">j</span>] = find(<span class="mxinfo" id="T31:U77"><span class="mxinfo" id="T31:U78"><span class="mxinfo" id="T31:U79"><span class="mxinfo" id="T31:U80"><span class="mxinfo" id="T22:U81"><span class="mxinfo" id="T9:U82">repmat(<span class="mxinfo" id="T1:U83">min(<span class="mxinfo" id="T1:U84"><span class="var type1" id="S4T12U160">x1</span>(<span class="mxinfo" id="T1:U86">1:end-1</span>)</span>,<span class="mxinfo" id="T1:U87"><span class="var type1" id="S4T12U168">x1</span>(<span class="mxinfo" id="T1:U89">2:end</span>)</span>)</span>,1,<span class="var type1" id="S13T1U174">n2</span>)</span>'</span> &lt;= <span class="keyword">...</span></span></span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="88,121" id="srcline121">121</a></span><span class="line"><span class="mxinfo" id="T22:U74"><span class="mxinfo" id="T31:U77"><span class="mxinfo" id="T31:U78"><span class="mxinfo" id="T31:U79"><span class="mxinfo" id="T31:U80">    <span class="mxinfo" id="T22:U91"><span class="mxinfo" id="T9:U92">repmat(<span class="mxinfo" id="T9:U93"><span class="mxinfo" id="T22:U94">max(<span class="mxinfo" id="T22:U95"><span class="var type1" id="S6T22U182">x2</span>(<span class="mxinfo" id="T1:U97">1</span>:<span class="mxinfo" id="T1:U98"><span class="mxinfo" id="T1:U99">end</span>-<span class="mxinfo" id="T1:U100">1</span></span>)</span>,<span class="mxinfo" id="T22:U101"><span class="var type1" id="S6T22U190">x2</span>(<span class="mxinfo" id="T1:U103">2</span>:<span class="mxinfo" id="T1:U104">end</span>)</span>)</span>.'</span>,<span class="var type1" id="S12T1U195">n1</span>,1)</span>'</span></span> &amp; <span class="keyword">...</span></span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="88,122" id="srcline122">122</a></span><span class="line"><span class="mxinfo" id="T22:U74"><span class="mxinfo" id="T31:U77"><span class="mxinfo" id="T31:U78"><span class="mxinfo" id="T31:U79">    <span class="mxinfo" id="T31:U106"><span class="mxinfo" id="T22:U107"><span class="mxinfo" id="T9:U108">repmat(<span class="mxinfo" id="T1:U109">max(<span class="mxinfo" id="T1:U110"><span class="var type1" id="S4T12U204">x1</span>(<span class="mxinfo" id="T1:U112">1:end-1</span>)</span>,<span class="mxinfo" id="T1:U113"><span class="var type1" id="S4T12U212">x1</span>(<span class="mxinfo" id="T1:U115">2:end</span>)</span>)</span>,1,<span class="var type1" id="S13T1U218">n2</span>)</span>'</span> &gt;= <span class="keyword">...</span></span></span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="88,123" id="srcline123">123</a></span><span class="line"><span class="mxinfo" id="T22:U74"><span class="mxinfo" id="T31:U77"><span class="mxinfo" id="T31:U78"><span class="mxinfo" id="T31:U79"><span class="mxinfo" id="T31:U106">    <span class="mxinfo" id="T22:U117"><span class="mxinfo" id="T9:U118">repmat(<span class="mxinfo" id="T9:U119"><span class="mxinfo" id="T22:U120">min(<span class="mxinfo" id="T22:U121"><span class="var type1" id="S6T22U226">x2</span>(<span class="mxinfo" id="T1:U123">1</span>:<span class="mxinfo" id="T1:U124"><span class="mxinfo" id="T1:U125">end</span>-<span class="mxinfo" id="T1:U126">1</span></span>)</span>,<span class="mxinfo" id="T22:U127"><span class="var type1" id="S6T22U234">x2</span>(<span class="mxinfo" id="T1:U129">2</span>:<span class="mxinfo" id="T1:U130">end</span>)</span>)</span>.'</span>,<span class="var type1" id="S12T1U239">n1</span>,1)</span>'</span></span></span> &amp; <span class="keyword">...</span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="88,124" id="srcline124">124</a></span><span class="line"><span class="mxinfo" id="T22:U74"><span class="mxinfo" id="T31:U77"><span class="mxinfo" id="T31:U78">    <span class="mxinfo" id="T31:U132"><span class="mxinfo" id="T22:U133"><span class="mxinfo" id="T9:U134">repmat(<span class="mxinfo" id="T1:U135">min(<span class="mxinfo" id="T1:U136"><span class="var type1" id="S5T12U248">y1</span>(<span class="mxinfo" id="T1:U138">1:end-1</span>)</span>,<span class="mxinfo" id="T1:U139"><span class="var type1" id="S5T12U256">y1</span>(<span class="mxinfo" id="T1:U141">2:end</span>)</span>)</span>,1,<span class="var type1" id="S13T1U262">n2</span>)</span>'</span> &lt;= <span class="keyword">...</span></span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="88,125" id="srcline125">125</a></span><span class="line"><span class="mxinfo" id="T22:U74"><span class="mxinfo" id="T31:U77"><span class="mxinfo" id="T31:U78"><span class="mxinfo" id="T31:U132">    <span class="mxinfo" id="T22:U143"><span class="mxinfo" id="T9:U144">repmat(<span class="mxinfo" id="T9:U145"><span class="mxinfo" id="T22:U146">max(<span class="mxinfo" id="T22:U147"><span class="var type1" id="S7T22U270">y2</span>(<span class="mxinfo" id="T1:U149">1</span>:<span class="mxinfo" id="T1:U150"><span class="mxinfo" id="T1:U151">end</span>-<span class="mxinfo" id="T1:U152">1</span></span>)</span>,<span class="mxinfo" id="T22:U153"><span class="var type1" id="S7T22U278">y2</span>(<span class="mxinfo" id="T1:U155">2</span>:<span class="mxinfo" id="T1:U156">end</span>)</span>)</span>.'</span>,<span class="var type1" id="S12T1U283">n1</span>,1)</span>'</span></span></span> &amp; <span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="88,126" id="srcline126">126</a></span><span class="line"><span class="mxinfo" id="T22:U74"><span class="mxinfo" id="T31:U77">    <span class="mxinfo" id="T31:U158"><span class="mxinfo" id="T22:U159"><span class="mxinfo" id="T9:U160">repmat(<span class="mxinfo" id="T1:U161">max(<span class="mxinfo" id="T1:U162"><span class="var type1" id="S5T12U292">y1</span>(<span class="mxinfo" id="T1:U164">1:end-1</span>)</span>,<span class="mxinfo" id="T1:U165"><span class="var type1" id="S5T12U300">y1</span>(<span class="mxinfo" id="T1:U167">2:end</span>)</span>)</span>,1,<span class="var type1" id="S13T1U306">n2</span>)</span>'</span> &gt;= <span class="keyword">...</span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="88,127" id="srcline127">127</a></span><span class="line"><span class="mxinfo" id="T22:U74"><span class="mxinfo" id="T31:U77"><span class="mxinfo" id="T31:U158">    <span class="mxinfo" id="T22:U169"><span class="mxinfo" id="T9:U170">repmat(<span class="mxinfo" id="T9:U171"><span class="mxinfo" id="T22:U172">min(<span class="mxinfo" id="T22:U173"><span class="var type1" id="S7T22U314">y2</span>(<span class="mxinfo" id="T1:U175">1</span>:<span class="mxinfo" id="T1:U176"><span class="mxinfo" id="T1:U177">end</span>-<span class="mxinfo" id="T1:U178">1</span></span>)</span>,<span class="mxinfo" id="T22:U179"><span class="var type1" id="S7T22U322">y2</span>(<span class="mxinfo" id="T1:U181">2</span>:<span class="mxinfo" id="T1:U182">end</span>)</span>)</span>.'</span>,<span class="var type1" id="S12T1U327">n1</span>,1)</span>'</span></span></span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="88,128" id="srcline128">128</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="88,129" id="srcline129">129</a></span><span class="line"><span class="mxinfo" id="T22:U184"><span class="var type1" id="S26T22U331">i_tmp</span> = <span class="var type1" id="S19T22U332">i</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="88,130" id="srcline130">130</a></span><span class="line"><span class="mxinfo" id="T22:U187"><span class="var type1" id="S27T22U335">j_tmp</span> = <span class="var type1" id="S20T22U336">j</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="88,131" id="srcline131">131</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="88,132" id="srcline132">132</a></span><span class="line"><span class="mxinfo" id="T9:U190"><span class="var type1" id="S19T9U339">i</span> = <span class="mxinfo" id="T9:U192"><span class="var type1" id="S27T22U341">j_tmp</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="88,133" id="srcline133">133</a></span><span class="line"><span class="mxinfo" id="T9:U194"><span class="var type1" id="S20T9U344">j</span> = <span class="mxinfo" id="T9:U196"><span class="var type1" id="S26T22U346">i_tmp</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="88,134" id="srcline134">134</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="88,135" id="srcline135">135</a></span><span class="line"><span class="comment">% Force i and j to be column vectors, even when their length is zero, i.e.,</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,136" id="srcline136">136</a></span><span class="line"><span class="comment">% we want them to be 0-by-1 instead of 0-by-0.</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,137" id="srcline137">137</a></span><span class="line"><span class="mxinfo" id="T48:U198"><span class="var type1" id="S19T48U349">i</span> = <span class="mxinfo" id="T48:U200">reshape(<span class="var type1" id="S19T9U352">i</span>,[],1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="88,138" id="srcline138">138</a></span><span class="line"><span class="mxinfo" id="T48:U202"><span class="var type1" id="S20T48U358">j</span> = <span class="mxinfo" id="T48:U204">reshape(<span class="var type1" id="S20T9U361">j</span>,[],1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="88,139" id="srcline139">139</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="88,140" id="srcline140">140</a></span><span class="line"><span class="comment">% Find segments pairs which have at least one vertex = NaN and remove them.</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,141" id="srcline141">141</a></span><span class="line"><span class="comment">% This line is a fast way of finding such segment pairs.  We take</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,142" id="srcline142">142</a></span><span class="line"><span class="comment">% advantage of the fact that NaNs propagate through calculations, in</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,143" id="srcline143">143</a></span><span class="line"><span class="comment">% particular subtraction (in the calculation of dxy1 and dxy2, which we</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,144" id="srcline144">144</a></span><span class="line"><span class="comment">% need anyway) and addition.</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,145" id="srcline145">145</a></span><span class="line"><span class="comment">% At the same time we can remove redundant combinations of i and j in the</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,146" id="srcline146">146</a></span><span class="line"><span class="comment">% case of finding intersections of a line with itself.</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,147" id="srcline147">147</a></span><span class="line"><span class="comment">% if self_intersect</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,148" id="srcline148">148</a></span><span class="line"><span class="comment">%   remove = isnan(sum(dxy1(i,:) + dxy2(j,:),2)) | j &lt;= i + 1;</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,149" id="srcline149">149</a></span><span class="line"><span class="comment">% else</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,150" id="srcline150">150</a></span><span class="line"><span class="comment">%   remove = isnan(sum(dxy1(i,:) + dxy2(j,:),2));</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,151" id="srcline151">151</a></span><span class="line"><span class="comment">% end</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,152" id="srcline152">152</a></span><span class="line"><span class="comment">% i(remove) = [];</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,153" id="srcline153">153</a></span><span class="line"><span class="comment">% j(remove) = [];</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,154" id="srcline154">154</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="88,155" id="srcline155">155</a></span><span class="line"><span class="comment">% Initialize matrices.  We'll put the T's and B's in matrices and use them</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,156" id="srcline156">156</a></span><span class="line"><span class="comment">% one column at a time.  AA is a 3-D extension of A where we'll use one</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,157" id="srcline157">157</a></span><span class="line"><span class="comment">% plane at a time.</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,158" id="srcline158">158</a></span><span class="line"><span class="mxinfo" id="T1:U206"><span class="var type1" id="S29T1U367">n</span> = <span class="mxinfo" id="T1:U208">length(<span class="var type1" id="S19T48U370">i</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="88,159" id="srcline159">159</a></span><span class="line"><span class="mxinfo" id="T44:U210"><span class="var type1" id="S30T44U373">T</span> = <span class="mxinfo" id="T44:U212">zeros(<span class="mxinfo" id="T1:U213">4</span>,<span class="var type1" id="S29T1U377">n</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="88,160" id="srcline160">160</a></span><span class="line"><span class="mxinfo" id="T38:U215"><span class="var type1" id="S32T38U380">AA</span> = <span class="mxinfo" id="T38:U217">zeros(<span class="mxinfo" id="T1:U218">4</span>,<span class="mxinfo" id="T1:U219">4</span>,<span class="var type1" id="S29T1U385">n</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="88,161" id="srcline161">161</a></span><span class="line"><span class="mxinfo" id="T63:U221"><span class="mxinfo" id="T63:U222"><span class="var type1" id="S32T38U389">AA</span>([1 2],3,:)</span> = <span class="mxinfo" id="T1:U224">-<span class="mxinfo" id="T1:U225">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="88,162" id="srcline162">162</a></span><span class="line"><span class="mxinfo" id="T63:U226"><span class="mxinfo" id="T63:U227"><span class="var type1" id="S32T38U401">AA</span>([3 4],4,:)</span> = <span class="mxinfo" id="T1:U229">-<span class="mxinfo" id="T1:U230">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="88,163" id="srcline163">163</a></span><span class="line"><span class="mxinfo" id="T63:U231"><span class="mxinfo" id="T63:U232"><span class="var type1" id="S32T38U413">AA</span>([1 3],1,:)</span> = <span class="mxinfo" id="T64:U234"><span class="mxinfo" id="T15:U235"><span class="var type1" id="S16T10U422">dxy1</span>(<span class="var type1" id="S19T48U423">i</span>,:)</span>.'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="88,164" id="srcline164">164</a></span><span class="line"><span class="mxinfo" id="T63:U238"><span class="mxinfo" id="T63:U239"><span class="var type1" id="S32T38U428">AA</span>([2 4],2,:)</span> = <span class="mxinfo" id="T27:U241"><span class="mxinfo" id="T27:U242"><span class="var type1" id="S18T27U437">dxy2</span>(<span class="var type1" id="S20T48U438">j</span>,:)</span>.'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="88,165" id="srcline165">165</a></span><span class="line"><span class="mxinfo" id="T44:U245"><span class="var type1" id="S33T44U442">B</span> = <span class="mxinfo" id="T44:U247">-<span class="mxinfo" id="T44:U248"><span class="mxinfo" id="T65:U249">[<span class="mxinfo" id="T48:U250"><span class="var type1" id="S4T12U448">x1</span>(<span class="var type1" id="S19T48U449">i</span>)</span> <span class="mxinfo" id="T48:U253"><span class="var type1" id="S6T22U451">x2</span>(<span class="var type1" id="S20T48U452">j</span>)</span> <span class="mxinfo" id="T48:U256"><span class="var type1" id="S5T12U454">y1</span>(<span class="var type1" id="S19T48U455">i</span>)</span> <span class="mxinfo" id="T48:U259"><span class="var type1" id="S7T22U457">y2</span>(<span class="var type1" id="S20T48U458">j</span>)</span>]</span>.'</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="88,166" id="srcline166">166</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="88,167" id="srcline167">167</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S34T1U461">k</span> = <span class="mxinfo" id="T1:U263">1</span>:<span class="var type1" id="S29T1U464">n</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,168" id="srcline168">168</a></span><span class="line">    <span class="mxinfo" id="T39:U265">[<span class="var type1" id="S35T39U468">L</span>,<span class="var type1" id="S36T39U469">U</span>] = lu(<span class="mxinfo" id="T39:U268"><span class="var type1" id="S32T38U473">AA</span>(:,:,<span class="var type1" id="S34T1U476">k</span>)</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="88,169" id="srcline169">169</a></span><span class="line">    <span class="mxinfo" id="T66:U271"><span class="mxinfo" id="T66:U272"><span class="var type1" id="S30T44U480">T</span>(:,<span class="var type1" id="S34T1U482">k</span>)</span> = <span class="mxinfo" id="T50:U275"><span class="var type1" id="S36T39U484">U</span>\(<span class="mxinfo" id="T50:U277"><span class="var type1" id="S35T39U487">L</span>\<span class="mxinfo" id="T50:U279"><span class="var type1" id="S33T44U489">B</span>(:,<span class="var type1" id="S34T1U491">k</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="88,170" id="srcline170">170</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,171" id="srcline171">171</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="88,172" id="srcline172">172</a></span><span class="line"><span class="comment">% Find where t1 and t2 are between 0 and 1 and return the corresponding</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,173" id="srcline173">173</a></span><span class="line"><span class="comment">% x0 and y0 values.</span></span></span>
<span class="srcline"><span class="lineno"><a href="88,174" id="srcline174">174</a></span><span class="line"><span class="mxinfo" id="T31:U282"><span class="var type1" id="S38T31U494">in_range</span> = <span class="mxinfo" id="T31:U284">(<span class="mxinfo" id="T67:U285"><span class="mxinfo" id="T67:U286"><span class="mxinfo" id="T67:U287"><span class="mxinfo" id="T67:U288"><span class="mxinfo" id="T9:U289"><span class="var type1" id="S30T44U502">T</span>(<span class="mxinfo" id="T1:U291">1</span>,:)</span> &gt;= <span class="mxinfo" id="T1:U292">0</span></span> &amp; <span class="mxinfo" id="T67:U293"><span class="mxinfo" id="T9:U294"><span class="var type1" id="S30T44U508">T</span>(<span class="mxinfo" id="T1:U296">2</span>,:)</span> &gt;= <span class="mxinfo" id="T1:U297">0</span></span></span> &amp; <span class="mxinfo" id="T67:U298"><span class="mxinfo" id="T9:U299"><span class="var type1" id="S30T44U514">T</span>(<span class="mxinfo" id="T1:U301">1</span>,:)</span> &lt; <span class="mxinfo" id="T1:U302">1</span></span></span> &amp; <span class="mxinfo" id="T67:U303"><span class="mxinfo" id="T9:U304"><span class="var type1" id="S30T44U520">T</span>(<span class="mxinfo" id="T1:U306">2</span>,:)</span> &lt; <span class="mxinfo" id="T1:U307">1</span></span></span>).'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="88,175" id="srcline175">175</a></span><span class="line"><span class="mxinfo" id="T22:U308"><span class="var type1" id="S2T22U526">x0</span> = <span class="mxinfo" id="T22:U310"><span class="mxinfo" id="T9:U311"><span class="var type1" id="S30T44U529">T</span>(<span class="mxinfo" id="T1:U313">3</span>,<span class="var type1" id="S38T31U531">in_range</span>)</span>.'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="88,176" id="srcline176">176</a></span><span class="line"><span class="mxinfo" id="T22:U315"><span class="var type1" id="S3T22U534">y0</span> = <span class="mxinfo" id="T22:U317"><span class="mxinfo" id="T9:U318"><span class="var type1" id="S30T44U537">T</span>(<span class="mxinfo" id="T1:U320">4</span>,<span class="var type1" id="S38T31U539">in_range</span>)</span>.'</span></span>;</span></span>
</pre>
